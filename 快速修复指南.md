# 快速修复指南 - Amazon Linux 2023

## 问题：mariadb-devel 包找不到

Amazon Linux 2023 使用不同的包名。请按以下步骤操作：

## 解决方案

### 方法1：手动安装MariaDB开发包

```bash
# 尝试安装MariaDB连接器（Amazon Linux 2023使用这个）
sudo dnf install -y mariadb-connector-c-devel

# 如果上面不行，尝试这个
sudo dnf install -y mysql-devel

# 或者安装完整的MariaDB服务器（如果还没安装）
sudo dnf install -y mariadb-server mariadb-devel
```

### 方法2：跳过MariaDB开发包（如果只是测试）

如果暂时不需要数据库功能，可以跳过，继续安装：

```bash
# 继续运行安装脚本，忽略mariadb-devel错误
# 脚本会继续执行
```

### 方法3：手动完成安装步骤

如果安装脚本有问题，可以手动执行：

```bash
# 1. 安装Python依赖（如果还没安装）
sudo dnf install -y python3 python3-pip python3-devel

# 2. 创建虚拟环境
python3 -m venv venv

# 3. 激活虚拟环境
source venv/bin/activate

# 4. 升级pip
pip install --upgrade pip setuptools wheel

# 5. 安装Python依赖（可能会提示mariadb相关错误，可以忽略）
pip install -r requirements.txt

# 6. 如果pymysql安装失败，可以单独安装
pip install pymysql

# 7. 安装Playwright
playwright install chromium

# 8. 创建必要目录
mkdir -p logs final_reports
mkdir -p insight_engine_streamlit_reports
mkdir -p media_engine_streamlit_reports
mkdir -p query_engine_streamlit_reports
```

## 继续数据库初始化

安装完成后，继续初始化数据库：

```bash
# 使用当前目录（./）作为项目路径
./deploy/setup_database.sh
# 当提示项目路径时，输入：/home/ec2-user/yuqing
# 或者使用绝对路径
```

## 验证安装

```bash
# 检查虚拟环境
ls -la venv/

# 检查Python包
source venv/bin/activate
pip list | grep -E "flask|pymysql|streamlit"

# 测试数据库连接
python3 -c "import pymysql; print('pymysql installed')"
```

## 如果还有问题

1. **检查Python版本**
   ```bash
   python3 --version
   # 需要3.9或更高版本
   ```

2. **检查pip**
   ```bash
   pip3 --version
   ```

3. **手动安装缺失的包**
   ```bash
   source venv/bin/activate
   pip install pymysql SQLAlchemy flask streamlit
   ```

## 下一步

安装完成后：
1. 配置`.env`文件
2. 初始化数据库
3. 测试启动

